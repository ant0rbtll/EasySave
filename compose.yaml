# docker-compose.yml (unique)
services:
  easysave-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: easysave-dev
    volumes:
      - .:/app
      - nuget-cache:/root/.nuget/packages
      # Pour tester les sauvegardes, montez un dossier spécifique
      - ./test-data:/test-data
    environment:
      - DOTNET_ENVIRONMENT=Development
      - DOTNET_USE_POLLING_FILE_WATCHER=true
      - HOME=/tmp  # Éviter le problème /.dotnet
      - NUGET_PACKAGES=/root/.nuget/packages  # Utiliser le cache monté
    stdin_open: true
    tty: true
    networks:
      - easysave-network

  easysave-test:
    build:
      context: .
      dockerfile: Dockerfile.test
    container_name: easysave-test
    volumes:
      - .:/app
      - ./test-results:/app/test-results
      - nuget-cache:/root/.nuget/packages
    environment:
      - DOTNET_ENVIRONMENT=Test
    networks:
      - easysave-network

volumes:
  nuget-cache:

networks:
  easysave-network:
    driver: bridge