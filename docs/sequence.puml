@startuml
title EasySave 1.0 - Séquence : Lancer via CLI et exécuter des travaux

actor Utilisateur as User
boundary "UI.ConsoleUI" as UI
control "CLI.CommandLineParser" as Parser
control "APP.BackupAppService" as App
entity "Persistence.ISaveWorkRepository" as Repo
control "Backup.BackupEngine" as Engine
control "EasyLog.ILogger\n(EasyLog.dll)" as Log
control "ETR.IStateWriter\n(state.json)" as State

== Démarrage ==
User -> UI : EasySave.exe "1-3" / "1;3"
UI -> App : RunFromArgs(args)
App -> Parser : Parse(args)

alt Syntaxe invalide
  Parser --> App : erreur
  App -> UI : ShowError(key)
  UI --> User : message d'aide
  return
else OK
  Parser --> App : ids : int[]
end

== Sélection des travaux ==
App -> App : RunJobs(ids)

loop pour chaque id
  App -> Repo : GetById(id)
  Repo --> App : job : CORE.SaveWork
end

alt Aucun travail
  App --> UI : ShowMessage(key)
  UI --> User : afficher
  return
end

== Exécution séquentielle ==
loop pour chaque job
  App -> Engine : Execute(job)

  Engine -> State : Update(entry)\n(status=Active, init totaux)
  Engine -> Log : Write(entry)\n(eventType=TransferFile/CreateDirectory)

  loop pour chaque fichier
    Engine -> State : Update(entry)\n(currentFile, progress, remaining)
    Engine -> Engine : TransferFile(src->dst)
    alt OK
      Engine -> Log : Write(entry)\n(transferTimeMs>=0)
    else Erreur
      Engine -> Log : Write(entry)\n(transferTimeMs<0, errorCode)
    end
  end

  Engine -> State : Update(entry)\n(status=Done)
  Engine -> State : MarkInactive(backupId)
end

App --> UI : ShowMessage(key)\n(résumé)
UI --> User : afficher

@enduml